jQuery(document).ready(function(e){var s,t,o,l,r,n,i,a,p,c,d,w,u,v=[];function h(e){var t=new google.maps.Marker({position:e,map:s,draggable:!0});v.push(t),google.maps.event.addListener(t,"dragend",function(){m(t.getPosition(),"store")})}function m(s,t){var o,l,r=(o=[],l=s.toString().split(",",2),o[0]=l[0].replace("(",""),o[1]=l[1].replace(")",""),o),n=g(r[0]),i=g(r[1]);"store"==t?(e("#wpsl-lat").val(n),e("#wpsl-lng").val(i)):"zoom"==t&&e("#wpsl-latlng").val(n+","+i)}function g(e){return Math.round(e*Math.pow(10,6))/Math.pow(10,6)}function f(s){e("#wpsl-meta-nav li"+(s="first"==s?":first-child":"."+s)+"-tab").hasClass("wpsl-active")||(e("#wpsl-meta-nav li"+s+"-tab").addClass("wpsl-active").siblings().removeClass("wpsl-active"),e(".wpsl-store-meta > div"+s).show().addClass("wpsl-active").siblings("div").hide().removeClass("wpsl-active"))}function y(){e("#wpsl-store-hours .wpsl-icon-cancel-circled").off(),e("#wpsl-store-hours .wpsl-icon-cancel-circled").on("click",function(){!function(e){var s=b(e),t=e.parents("tr"),o=t.find(".wpsl-opening-hours").attr("data-day");1==s&&t.find(".wpsl-opening-hours").html("<p class='wpsl-store-closed'>"+wpslL10n.closedDate+"<input type='hidden' name='wpsl[hours]["+o+"_open]' value='' /></p>");e.parent().closest(".wpsl-current-period").remove(),t.find(".wpsl-opening-hours div:first-child").hasClass("wpsl-multiple-periods")&&t.find(".wpsl-opening-hours div:first-child").removeClass("wpsl-multiple-periods")}(e(this))})}function b(e){return e.parents("tr").find(".wpsl-current-period").length}function C(s){var t,o,l,r,n,i,a,p,c,d,w=!1,u=!1,v="",h="",m=[],g={hr12:[12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11],hr24:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]},f=["00","15","30","45"];r=e("#wpsl-editor-hour-format").length?e("#wpsl-editor-hour-format").val():wpslSettings.hourFormat,e("#wpsl-store-hours td").removeAttr("style"),12==r?(e("#wpsl-store-hours").removeClass().addClass("wpsl-twelve-format"),t=g.hr12):(e("#wpsl-store-hours").removeClass().addClass("wpsl-twentyfour-format"),t=g.hr24),o=f;for(var y=0;y<t.length;y++){l=t[y],12==r?(l>=12&&(w=!!u,u=!0),v=w?"PM":"AM"):24==r&&1==l.toString().length&&(l="0"+l);for(var b=0;b<o.length;b++)m.push(l+":"+o[b]+" "+v)}for(y=0;y<m.length;y++)h=h+'<option value="'+e.trim(m[y])+'">'+e.trim(m[y])+"</option>";if(s)return h;n=h,i=r,d={},e(".wpsl-current-period").each(function(){c=e(this),d={open:e(this).find(".wpsl-open-hour").val(),close:e(this).find(".wpsl-close-hour").val()},e(this).find("select").html(n).promise().done(function(){for(var s in d)d.hasOwnProperty(s)&&(a=d[s].split(":"),12==i?(p="",0==d[s].charAt(0)?(d[s]=d[s].substr(1),p=" AM"):2==a[0].length&&a[0]>12?(d[s]=a[0]-12+":"+a[1],p=" PM"):a[0]<12?(d[s]=a[0]+":"+a[1],p=" AM"):12==a[0]&&(d[s]=a[0]+":"+a[1],p=" PM"),-1==a[1].indexOf("PM")&&-1==a[1].indexOf("AM")&&(d[s]=d[s]+p)):24==i&&(-1!=a[1].indexOf("PM")?12==a[0]?d[s]="12:"+a[1].replace(" PM",""):d[s]=+a[0]+12+":"+a[1].replace(" PM",""):-1!=a[1].indexOf("AM")?1==a[0].toString().length?d[s]="0"+a[0]+":"+a[1].replace(" AM",""):d[s]=a[0]+":"+a[1].replace(" AM",""):d[s]=a[0]+":"+a[1]),c.find(".wpsl-"+s+"-hour option[value='"+e.trim(d[s])+"']").attr("selected","selected"))})})}function M(){var t="",o=e.trim(e("#wpsl-map-style").val());e(".wpsl-style-preview-error").remove(),o&&((t=function(e){try{var s=JSON.parse(e);if(s&&"object"==typeof s&&null!==s)return s}catch(e){}return!1}(o))||e("#wpsl-style-preview").after("<div class='wpsl-style-preview-error'>"+wpslL10n.styleError+"</div>")),s.setOptions({styles:t})}function k(s,t){var o,l;o='<div id="setting-error-'+t+'" class="error settings-error notice is-dismissible">',o+="<p><strong>"+s+"</strong></p>",o+='<button type="button" class="notice-dismiss"><span class="screen-reader-text">'+wpslL10n.dismissNotice+"</span></button>",o+="</div>",l=e("#wpsl-tabs").length?"wpsl-tabs":"wpsl-settings-form",e("#"+l).before(o),e("#wpsl-api-"+t).addClass("wpsl-error")}e("#wpsl-gmap-wrap").length&&(o=wpslSettings.defaultLatLng.split(","),l=new google.maps.LatLng(o[0],o[1]),r={},r={zoom:parseInt(wpslSettings.defaultZoom),center:l,mapTypeId:google.maps.MapTypeId[wpslSettings.mapType.toUpperCase()],mapTypeControl:!1,streetViewControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP}},t=new google.maps.Geocoder,s=new google.maps.Map(document.getElementById("wpsl-gmap-wrap"),r),i=e("#wpsl-lat").val(),a=e("#wpsl-lng").val(),i&&a&&(n=new google.maps.LatLng(i,a),s.setCenter(n),s.setZoom(16),h(n))),e("#wpsl-map-settings").length&&(c=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,d=e("#wpsl-start-name"),void 0!==c&&new c(function(s){s.forEach(function(s){"class"===s.attributeName&&-1!==e(s.target).prop(s.attributeName).indexOf("gm-err-autocomplete")&&k(wpslL10n.browserKeyError,"browser-key")})}).observe(d[0],{attributes:!0}),e("#wpsl-api-server-key").hasClass("wpsl-validate-me")&&!e("#setting-error-server-key").length&&(p={action:"validate_server_key",server_key:e("#wpsl-api-server-key").val()},e.get(wpslSettings.ajaxurl,p,function(s){s.valid||void 0===s.msg?e("#wpsl-api-server-key").removeClass("wpsl-error"):k(s.msg,"server-key")}))),e("#wpsl-start-name").length&&(w=document.getElementById("wpsl-start-name"),u=new google.maps.places.Autocomplete(w,{types:["geocode"]}),google.maps.event.addListener(u,"place_changed",function(){m(u.getPlace().geometry.location,"zoom")})),e("#wpsl-lookup-location").on("click",function(o){var l,r;o.preventDefault(),!function(){var s,t,o=!1;if(e(".wpsl-store-meta input").removeClass("wpsl-error"),void 0!==wpslSettings.requiredFields&&_.isArray(wpslSettings.requiredFields))for(t=wpslSettings.requiredFields,s=0;s<t.length;s++)e.trim(e("#wpsl-"+t[s]).val())||(e("#wpsl-"+t[s]).addClass("wpsl-error"),o=!0);return o}()?(r=function(){var s,t,o=[],l=["address","city","state","zip","country"];for(s=0;s<l.length;s++)(t=e.trim(e("#wpsl-"+l[s]).val()))&&o.push(t),t="";return o.join()}(),t.geocode({address:r},function(t,o){o===google.maps.GeocoderStatus.OK?(void 0!==v[0]&&v[0].draggable&&(v[0].setMap(null),v.splice(0,1)),s.setCenter(t[0].geometry.location),s.setZoom(16),h(t[0].geometry.location),m(t[0].geometry.location,"store"),l=function(e){var s,t,o={},l=e[0].address_components.length;for(s=0;s<l;s++)t=e[0].address_components[s].types,/^country,political$/.test(t)&&(o={long_name:e[0].address_components[s].long_name,short_name:e[0].address_components[s].short_name});return{country:o}}(t),e("#wpsl-country").val(l.country.long_name),e("#wpsl-country_iso").val(l.country.short_name)):alert(wpslL10n.geocodeFail+": "+o)})):(f("first"),alert(wpslL10n.missingGeoData))}),e(".wpsl-marker-list input[type=radio]").click(function(){e(this).parents(".wpsl-marker-list").find("li").removeClass(),e(this).parent("li").addClass("wpsl-active-marker")}),e(".wpsl-marker-list li").click(function(){e(this).parents(".wpsl-marker-list").find("input").prop("checked",!1),e(this).find("input").prop("checked",!0),e(this).siblings().removeClass(),e(this).addClass("wpsl-active-marker")}),e(".wpsl-has-conditional-option").on("change",function(){e(this).parent().next(".wpsl-conditional-option").toggle()}),e("#wpsl-store-template").on("change",function(){var s=e("#wpsl-listing-below-no-scroll");"below_map"==e(this).val()?s.show():s.hide()}),e("#wpsl-api-region").on("change",function(){var s=e("#wpsl-geocode-component");e(this).val()?s.show():s.hide()}),e("#wpsl-editor-hour-input").on("change",function(){e(".wpsl-"+e(this).val()+"-hours").show().siblings("div").hide(),e(".wpsl-hour-notice").toggle()}),e("#wpsl-meta-nav li").on("click",function(s){var t=e(this).attr("class");t=t.split("-tab"),s.stopPropagation(),e(this).addClass("wpsl-active").siblings().removeClass("wpsl-active"),e(".wpsl-store-meta ."+t[0]).show().addClass("wpsl-active").siblings("div").hide().removeClass("wpsl-active")}),e("#wpsl-store-details").length&&e("#publish").click(function(){var s,t,o,l='<div id="message" class="error"><p>'+wpslL10n.requiredFields+"</p></div>",r=!1;return e("#wpbody-content .wrap #message").remove(),e(".wpsl-required").removeClass("wpsl-error"),e(".wpsl-required").each(function(){""==e(this).val()&&(e(this).addClass("wpsl-error"),void 0===s&&(s=function(e){var s={type:"id",val:e.attr("id")};void 0===s.val&&(s={type:"class",val:e.attr("class")});return s}(e(this))),r=!0)}),!r||(e("#wpbody-content .wrap > h2").after(l),void 0!==s.val&&("id"==s.type?(t=e("#"+s.val).parents(".wpsl-tab").attr("class"),e("html, body").scrollTop(Math.round(e("#"+s.val).offset().top-100))):"class"==s.type&&(o=s.val.replace(/wpsl-required|wpsl-error/g,""),t=e("."+o).parents(".wpsl-tab").attr("class"),e("html, body").scrollTop(Math.round(e("."+o).offset().top-100))),t=e.trim(t.replace(/wpsl-tab|wpsl-active/g,""))),f(t||"first"),e("#publish").removeClass("button-primary-disabled"),e(".spinner").hide(),!1)}),e("#wpsl-store-hours").length&&y(),e(".wpsl-add-period").on("click",function(s){var t,o={},l=e(this).parents("tr"),r=b(e(this))>=1?"wpsl-current-period wpsl-multiple-periods":"wpsl-current-period",n=l.find(".wpsl-opening-hours").attr("data-day"),i=e("#wpsl-settings-form").length?"wpsl_editor[dropdown]":"wpsl[hours]";t='<div class="'+r+'">',t+='<select autocomplete="off" name="'+i+"["+n+'_open][]" class="wpsl-open-hour">'+C(!0)+"</select>",t+="<span> - </span>",t+='<select autocomplete="off" name="'+i+"["+n+'_close][]" class="wpsl-close-hour">'+C(!0)+"</select>",t+='<div class="wpsl-icon-cancel-circled"></div>',t+="</div>",l.find(".wpsl-store-closed").remove(),e("#wpsl-hours-"+n).append(t).end(),y(),o=24==e("#wpsl-editor-hour-format").val()?{open:"09:00",close:"17:00"}:{open:"9:00 AM",close:"5:00 PM"},l.find(".wpsl-open-hour:last option[value='"+o.open+"']").attr("selected","selected"),l.find(".wpsl-close-hour:last option[value='"+o.close+"']").attr("selected","selected"),s.preventDefault()}),e("#wpsl-editor-hour-format, #wpsl-editor-hour-interval").on("change",function(){C()}),e(".wpsl-info").on("mouseover",function(){e(this).find(".wpsl-info-text").show()}),e(".wpsl-info").on("mouseout",function(){e(this).find(".wpsl-info-text").hide()}),e("#wpsl-latlng").length&&!e("#wpsl-latlng").val()&&e("#wpsl-latlng").siblings("label").find(".wpsl-info").addClass("wpsl-required-setting"),e("#wpsl-map-style").val()&&M(),e("#wpsl-style-preview").on("click",function(){return M(),!1}),e("#wpsl-wrap").on("click","button.notice-dismiss",function(){e(this).closest("div.notice").remove()})});